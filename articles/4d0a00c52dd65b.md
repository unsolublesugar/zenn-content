---
title: "Unity 2022ã‚¢ãƒƒãƒ—ãƒ‡ãƒ¼ãƒˆæ™‚ã«ç™ºç”Ÿã—ãŸã‚¨ãƒ©ãƒ¼å¯¾å¿œãƒ¡ãƒ¢"
emoji: "ğŸ› ï¸"
type: "tech" # tech: æŠ€è¡“è¨˜äº‹ / idea: ã‚¢ã‚¤ãƒ‡ã‚¢
topics: [unity, iOS, AdMob, firebase]
published: true
---

ã¨ã‚ã‚‹Unityã‚¢ãƒ—ãƒªé–‹ç™ºã®ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã«ã¦ã€é–‹ç™ºç’°å¢ƒã‚’Unity 2021ã‹ã‚‰2022ã¸ã‚¢ãƒƒãƒ—ãƒ‡ãƒ¼ãƒˆã—ãŸéš›ã«ç™ºç”Ÿã—ãŸã‚¨ãƒ©ãƒ¼ã®å¯¾å¿œãƒ¡ãƒ¢ã§ã™ã€‚


:::message
ç’°å¢ƒ: Unity 2021.3.37f1 -> 2022.3.25f1
:::

## Reference has errors 'Google.IOSResolver'.

```shell
Assembly 'Library/ScriptAssemblies/Assembly-CSharp-Editor.dll' will not be loaded due to errors:
Reference has errors 'Google.IOSResolver'.
```

### åŸå› 
Unityã«iOSãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ãŒã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã•ã‚Œã¦ã„ãªã„å ´åˆã«ç™ºç”Ÿã™ã‚‹ã‚¨ãƒ©ãƒ¼ã€‚

### å¯¾å¿œ

Unity Hubã®Installsã«ã¦å¯¾è±¡ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã®Unityã‚’é¸æŠã€‚`Add modules`ã‹ã‚‰ `iOS Build Support` ã‚’è¿½åŠ ã—ã¦è§£æ¶ˆã€‚

![](https://storage.googleapis.com/zenn-user-upload/a2730efac6c8-20240605.png)

![](https://storage.googleapis.com/zenn-user-upload/f53a8066dc61-20240605.png)

### å‚è€ƒ

> Check if you have iOS module installed for your unity editor. If not, install it from unity hub.
> 
> https://forum.unity.com/threads/google-iosresolver-will-not-be-loaded-in-2021-1-11f1-and-later.1128617/#post-9101890

## System.InvalidOperationException: Insecure connection not allowed


```shell
Job failed with exception: System.Reflection.TargetInvocationException: Exception has been thrown by the target of an invocation. ---> System.InvalidOperationException: Insecure connection not allowed
  at (wrapper managed-to-native) UnityEngine.Networking.UnityWebRequest.BeginWebRequest(UnityEngine.Networking.UnityWebRequest)
  at UnityEngine.Networking.UnityWebRequest.SendWebRequest () [0x00001] in <ce006d9cdd7f42a88f73d37c00d20828>:0 
  at (wrapper managed-to-native) System.Reflection.RuntimeMethodInfo.InternalInvoke(System.Reflection.RuntimeMethodInfo,object,object[],System.Exception&)
  at System.Reflection.RuntimeMethodInfo.Invoke (System.Object obj, System.Reflection.BindingFlags invokeAttr, System.Reflection.Binder binder, System.Object[] parameters, System.Globalization.CultureInfo culture) [0x0006a] in <b11ba2a8fbf24f219f7cc98532a11304>:0 
   --- End of inner exception stack trace ---
  at System.Reflection.RuntimeMethodInfo.Invoke (System.Object obj, System.Reflection.BindingFlags invokeAttr, System.Reflection.Binder binder, System.Object[] parameters, System.Globalization.CultureInfo culture) [0x00083] in <b11ba2a8fbf24f219f7cc98532a11304>:0 
  at System.Reflection.MethodBase.Invoke (System.Object obj, System.Object[] parameters) [0x00000] in <b11ba2a8fbf24f219f7cc98532a11304>:0 
  at Google.PortableWebRequest.StartRequest (Google.PortableWebRequest+HttpMethod method, System.String url, System.Collections.Generic.IDictionary`2[TKey,TValue] headers, UnityEngine.WWWForm form) [0x0019e] in <3d721d59d99942a585ced249e28ec6ca>:0 
  at Google.PortableWebRequest+<StartRequestOnMainThread>c__AnonStorey6.<>m__C () [0x00000] in <3d721d59d99942a585ced249e28ec6ca>:0 
  at Google.RunOnMainThread.ExecuteNext () [0x0003d] in <3d721d59d99942a585ced249e28ec6ca>:0 
UnityEngine.Debug:LogError (object)
Google.RunOnMainThread:ExecuteNext ()
Google.RunOnMainThread:<ExecuteAllUnnested>m__12 ()
Google.RunOnMainThread:RunAction (System.Action)
Google.RunOnMainThread:ExecuteAllUnnested (bool)
Google.RunOnMainThread:ExecuteAll ()
UnityEditor.EditorApplication:Internal_CallUpdateFunctions ()
```

### åŸå› 
Unity 2022ä»¥å¾Œã§ã¯ã€HTTPçµŒç”±ã§ã®ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã‚’è¨±å¯ã—ãªã„è¨­å®šãŒãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã¨ãªã£ã¦ã„ã‚‹ã€‚

> HTTP çµŒç”±ã§ã®ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã®ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã‚’è¨±å¯ã™ã‚‹ã‹ã©ã†ã‹æŒ‡å®šã—ã¾ã™ã€‚é¸æŠå¯èƒ½ãªã‚ªãƒ—ã‚·ãƒ§ãƒ³ã¯ Not allowedã€Allowed in Development builds onlyã€Always allowed ã§ã™ã€‚ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã®ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã¯ Not allowed ã§ã™ã€‚ã“ã‚Œã¯ã€ã‚ˆã‚Šå®‰å…¨ãªãƒ—ãƒ­ãƒˆã‚³ãƒ«ã§ã‚ã‚‹ HTTPS ãŒæ¨å¥¨ã•ã‚Œã‚‹ãŸã‚ã§ã™ã€‚
>
> https://docs.unity3d.com/ja/2022.3/Manual/class-PlayerSettingsWebGL.html

Firebaseã‚„AdMobãªã©ã€Googleç³»ã®ãƒ‡ãƒ¼ã‚¿è§£æãƒ»åºƒå‘ŠSDKã‚’å°å…¥ã—ã¦ã„ã‚‹å ´åˆã€Editorã®ä½¿ç”¨çŠ¶æ³ãƒ¬ãƒãƒ¼ãƒˆé€ä¿¡ã§httpé€šä¿¡ãŒè¡Œã‚ã‚Œã¦ã„ã‚‹ã“ã¨ãŒåŸå› ã€‚

> EditorMeasurement used to use http:// instead of https:// to report editor usage. This is causing later version of Unity to log warnings and errors. Even though this is harmless, the logs still looks concerning.
> 
> https://github.com/googlesamples/unity-jar-resolver/pull/548

### å¯¾å¿œ
[unity-jar-resolver](https://github.com/googlesamples/unity-jar-resolver)ã®ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‚’å‚ç…§ã—ã€è©²å½“ã™ã‚‹ãƒ¬ãƒãƒ¼ãƒˆé€ä¿¡ã‚’ç„¡åŠ¹ã«ã™ã‚‹ã€‚
ä»¥ä¸‹è¨­å®šã®Enable Analytics Reportingã®ãƒã‚§ãƒƒã‚¯ã‚’å¤–ã—ã€OKãƒœã‚¿ãƒ³ã‚¯ãƒªãƒƒã‚¯ã§ä¿å­˜ã—ã¦è§£æ¶ˆã€‚

```
Assets > External Dependency Manager > Version Handler > Settings
```

![](https://storage.googleapis.com/zenn-user-upload/d62d6884bd83-20240605.png)

ãªãŠã€Unityã‚¨ãƒ‡ã‚£ã‚¿ã®Project Settingsã«ã¦ `Allow downloads over HTTP` ã‚’ `Always allowed` ã¸å¤‰æ›´ã—ã¦ã‚‚ã‚¨ãƒ©ãƒ¼è§£æ¶ˆå¯èƒ½ã ãŒã€HTTPé€šä¿¡ã¯éæ¨å¥¨ã§ã‚ã‚‹ãŸã‚ã€å‰è¿°ã®è¨­å®šå¤‰æ›´ã‚’è¡Œã†ã‹ã€å¤–éƒ¨é€šä¿¡æ™‚ã®æ¥ç¶šå¯¾è±¡ã‚’HTTPSã«é™å®šã™ã‚‹å½¢ãŒæœ›ã¾ã—ã„ã€‚

### å‚è€ƒ

#### Enable Analytics Reportingã®è¨­å®šå¤‰æ›´

> Thank you for reporting this issue. Seems like Unity 2022 added some security feature which blocks the non-https web request. I wonder why it used http in the first place.
> 
> At the meantime, as a workaround, I would recommend you to disable Analytics reporting from our editor tools for now. Here are all the settings:
> 
> EDM4U: Assets > External Dependency Manager > Version Handler > Settings > Enable Analytics Reporting
> Firebase: Windows > Firebase > Documentation > Enable Analytics Reporting (At the very bottom)
> 
> https://github.com/googlesamples/unity-jar-resolver/issues/484#issuecomment-993910648

#### Allow downloads over HTTPã®è¨­å®šå¤‰æ›´

> Solved this by (Workaround): Edit -> Project Settings -> Player -> Other Settings -> Configuration -> Allow downloads over HTTP
set "Always allowed"...
>
> https://forum.unity.com/threads/job-failed-with-exception-system-reflection-targetinvocationexception-unity-error.1294134/#post-8590033

## A problem occurred evaluating settings 'Gradle'. Could not find method dependencyResolutionManagement()

```shell
Starting a Gradle Daemon, 1 incompatible Daemon could not be reused, use --status for details

UnityEngine.GUIUtility:ProcessEvent (int,intptr,bool&)
```

```shell
Picked up JAVA_TOOL_OPTIONS: -Dfile.encoding=UTF-8

FAILURE: Build failed with an exception.

* Where:
Settings file 'C:\[PROJECTS_DIR]\Library\Bee\Android\Prj\IL2CPP\Gradle\settings.gradle' line: 14

* What went wrong:
A problem occurred evaluating settings 'Gradle'.
> Could not find method dependencyResolutionManagement() for arguments [settings_7nhrnu9w9v0k2m11cwns18lff$_run_closure1@205a5df4] on settings 'Gradle' of type org.gradle.initialization.DefaultSettings.

* Try:
Run with --stacktrace option to get the stack trace. Run with --info or --debug option to get more log output. Run with --scan to get full insights.

* Get more help at https://help.gradle.org

BUILD FAILED in 3s

UnityEngine.GUIUtility:ProcessEvent (int,intptr,bool&)

```

```shell

CommandInvokationFailure: Gradle build failed. 
C:\Unity\Hub\Editor\2022.3.25f1\Editor\Data\PlaybackEngines\AndroidPlayer\OpenJDK\bin\java.exe -classpath "C:\Unity\Hub\Editor\2022.3.25f1\Editor\Data\PlaybackEngines\AndroidPlayer\Tools\gradle\gradle-6.7.1\lib\gradle-launcher-6.7.1.jar" org.gradle.launcher.GradleMain "-Dorg.gradle.jvmargs=-Xmx4096m" "assembleRelease"

Environment Variables:
PROCESSOR_ARCHITECTURE = AMD64

ï½ ä¸­ç•¥ ï½

stderr[
Picked up JAVA_TOOL_OPTIONS: -Dfile.encoding=UTF-8

FAILURE: Build failed with an exception.

* Where:
Settings file 'C:\[PROJECTS_DIR]\Library\Bee\Android\Prj\IL2CPP\Gradle\settings.gradle' line: 14

* What went wrong:
A problem occurred evaluating settings 'Gradle'.
> Could not find method dependencyResolutionManagement() for arguments [settings_7nhrnu9w9v0k2m11cwns18lff$_run_closure1@205a5df4] on settings 'Gradle' of type org.gradle.initialization.DefaultSettings.

* Try:
Run with --stacktrace option to get the stack trace. Run with --info or --debug option to get more log output. Run with --scan to get full insights.

* Get more help at https://help.gradle.org

BUILD FAILED in 3s
]
stdout[
Starting a Gradle Daemon, 1 incompatible Daemon could not be reused, use --status for details
]
exit code: 1
UnityEditor.Android.Command.WaitForProgramToRun (UnityEditor.Utils.Program p, UnityEditor.Android.Command+WaitingForProcessToExit waitingForProcessToExit, System.String errorMsg) (at <7564edb1c71b4762a209de01409ad6c0>:0)
UnityEditor.Android.Command.Run (System.Diagnostics.ProcessStartInfo psi, UnityEditor.Android.Command+WaitingForProcessToExit waitingForProcessToExit, System.String errorMsg) (at <7564edb1c71b4762a209de01409ad6c0>:0)
UnityEditor.Android.Command.Run (System.String command, System.String args, System.String workingdir, UnityEditor.Android.Command+WaitingForProcessToExit waitingForProcessToExit, System.String errorMsg) (at <7564edb1c71b4762a209de01409ad6c0>:0)
UnityEditor.Android.AndroidJavaTools.RunJava (System.String args, System.String workingdir, System.Action`1[T] progress, System.String error) (at <7564edb1c71b4762a209de01409ad6c0>:0)
UnityEditor.Android.GradleWrapper.Run (UnityEditor.Android.AndroidJavaTools javaTools, Unity.Android.Gradle.AndroidGradle androidGradle, System.String workingdir, System.String task, System.Action`1[T] progress) (at <7564edb1c71b4762a209de01409ad6c0>:0)
Rethrow as GradleInvokationException: Gradle build failed
UnityEditor.Android.GradleWrapper.Run (UnityEditor.Android.AndroidJavaTools javaTools, Unity.Android.Gradle.AndroidGradle androidGradle, System.String workingdir, System.String task, System.Action`1[T] progress) (at <7564edb1c71b4762a209de01409ad6c0>:0)
UnityEditor.Android.PostProcessor.Tasks.BuildGradleProject.Execute (UnityEditor.Android.PostProcessor.PostProcessorContext context) (at <7564edb1c71b4762a209de01409ad6c0>:0)
UnityEditor.Android.PostProcessor.PostProcessRunner.RunAllTasks (UnityEditor.Android.PostProcessor.PostProcessorContext context) (at <7564edb1c71b4762a209de01409ad6c0>:0)
UnityEngine.GUIUtility:ProcessEvent(Int32, IntPtr, Boolean&)

```

```shell
Build completed with a result of 'Failed' in 19 seconds (19043 ms)
3 errors
UnityEngine.GUIUtility:ProcessEvent (int,intptr,bool&)
```

### åŸå› 

Gradleçµ¡ã¿ã®ã‚¨ãƒ©ãƒ¼ã¯å¤§é‡ã®ãƒ­ã‚°ãŒå‡ºåŠ›ã•ã‚Œã€ãƒ‘ãƒƒã¨è¦‹ã§åŸå› ãŒåˆ†ã‹ã‚Šã¥ã‚‰ã„ãŒã€ŒWhat went wrong:ã€éƒ¨åˆ†ã‚’èª­ã‚€ã¨è§£æ±ºãŒæ—©ã„ã€‚ã“ã“ã§ã¯ `dependencyResolutionManagement()` ãƒ¡ã‚½ãƒƒãƒ‰ãŒè¦‹ã¤ã‹ã‚‰ãªã„ã¨ã„ã†ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¦ã„ãŸã€‚

```shell

* What went wrong:
A problem occurred evaluating settings 'Gradle'.
> Could not find method dependencyResolutionManagement()

```

è©²å½“ãƒ¡ã‚½ãƒƒãƒ‰ã¯Gradle 6.8ã§è¿½åŠ ã•ã‚ŒãŸã‚‚ã®ã§ã€Unityãƒãƒ¼ã‚¸ãƒ§ãƒ³ã‚¢ãƒƒãƒ—å¾Œã«åˆã‚ã›ã¦æ›´æ–°ã—ãŸåºƒå‘ŠSDKã‹ã‚‰å‘¼ã°ã‚Œã¦ã„ã‚‹ã€‚

https://docs.gradle.org/6.8/release-notes.html

`Assets/Plugins/Android/baseProjectTemplate.gradle` ã‚’ç¢ºèªã™ã‚‹ã¨ã€Unity 2021ã§ä½¿ç”¨ã•ã‚Œã‚‹ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã®çŠ¶æ…‹ã«ãªã£ã¦ã„ãŸã€‚å‚ç…§ã—ã¦ã„ã‚‹Gradleé–¢é€£ãƒ•ã‚¡ã‚¤ãƒ«ãŒå¤ã„ãŸã‚ã€è©²å½“ãƒ¡ã‚½ãƒƒãƒ‰ã®æ¤œè¨¼ãŒã‚³ã‚±ã¦ã„ã‚‹æ¨¡æ§˜ã€‚

```
classpath 'com.android.tools.build:gradle:4.0.1'
```

Unityã§ä½¿ç”¨ã•ã‚Œã‚‹Gradleãƒãƒ¼ã‚¸ãƒ§ãƒ³ã¯ä»¥ä¸‹ã®ã¨ãŠã‚Šã€‚

| Unity version	| Gradle version	| Android Gradle Plug-in version| 
| ---- | ---- |---- |
| 6000.0	| 8.4	| 8.3.0
| 2022.3 | 7.2 |7.1.2| 
| 2021.3 <br> 2020.3 starting from 2020.3.15f1 | 	6.1.1 | 4.0.1 |
| 2020.3 up to and including 2020.3.14f1	| 5.6.4	| 4.0.1

https://docs.unity3d.com/Manual/android-gradle-overview.html

### å¯¾å¿œ

Project Settingsã®è¨­å®šã‹ã‚‰ã€å‚ç…§ã•ã‚Œã¦ã„ã‚‹Gradleé–¢é€£ãƒ•ã‚¡ã‚¤ãƒ«ã‚’å†ç”Ÿæˆã™ã‚‹ã€‚
```
Assets > External Dependency Manager > Android Resolver > Force Resolve
```

`Assets/Plugins/Android`é…ä¸‹ã® `baseProjectTemplate`, `gradleTemplate`, `launcherTemplate`, `mainTemplate`, `settingsTemplate` ç­‰ã‚’åˆ¥ãƒ•ã‚©ãƒ«ãƒ€ã¸é€€é¿ï¼ˆãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ï¼‰ã—ã€Androidã®Buildè¨­å®šã‚’é–‹ãã€‚

```
Edit > Project Settings > Player > Android > Publishing Settings > Build
```

ä»¥ä¸‹ã®é …ç›®ã®ãƒã‚§ãƒƒã‚¯ã‚’ä»˜ã‘ç›´ã™ã¨ã€å„é …ç›®ã«å¯¾å¿œã—ãŸé–¢é€£ãƒ•ã‚¡ã‚¤ãƒ«ãŒå†ç”Ÿæˆã•ã‚Œã‚‹ã€‚

- Custom Main Gradle Template
- Custom Launcher Gradle Template
- Custom Base Gradle Template
- Custom Gradle Properties Template

æ”¹ã‚ã¦ `Force Resolve`ã‚’å®Ÿè¡Œã™ã‚‹ã¨ `baseProjectTemplate.gradle` ç­‰ã«è¨˜è¼‰ã®Gradleãƒãƒ¼ã‚¸ãƒ§ãƒ³ãŒ `7.1.2` ã«ãªã‚Šã€ãƒ“ãƒ«ãƒ‰ãŒé€šã‚‹ã‚ˆã†ã«ãªã£ãŸã€‚

Gradleé–¢é€£ã®ã‚¨ãƒ©ãƒ¼ã¯å¤šå²ã«æ¸¡ã‚‹ãŸã‚ã€ã‚°ã‚°ã£ã¦ã‚‚åˆ¥äº‹è±¡ã®æƒ…å ±ã°ã‹ã‚Šã§æ²¼ã«ãƒãƒã‚‹ã“ã¨ãŒã‚ˆãã‚ã‚‹ã€‚è‡ªèº«ãŒé­é‡ã—ãŸã‚¨ãƒ©ãƒ¼åŸå› ã¨å¯¾ç­–ã®è©³ç´°ã‚’æ›¸ãæ®‹ã—ã¦ãŠãã¨ã€è©²å½“ã™ã‚‹äº‹è±¡ã‹å¦ã‹ã‚’åˆ¤æ–­ã—ã‚„ã™ããªã‚‹ã ã‚ã†ã€‚


### å‚è€ƒ

- https://takoyaking.hatenablog.com/entry/gradle_unity2021_firebase
- https://stackoverflow.com/questions/77804040/what-missing-argument-gradle-in-settings-gradle

## å‚ç…§ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã®ãƒãƒ¼ã‚¸ãƒ§ãƒ³ç«¶åˆã‚¨ãƒ©ãƒ¼

ãŠãªã˜ã¿ã®ã‚¨ãƒ©ãƒ¼ãªã®ã§ãƒ­ã‚°ã‚’æ®‹ã—å¿˜ã‚ŒãŸãŒ `Multiple Dex Files` ãªã©å‡ºã¦ãŠã‚Šã€`android-core` ã‚„ `facebook-android-wrapper` ã® `.aar` ãƒ•ã‚¡ã‚¤ãƒ«ãŒç¾…åˆ—ã•ã‚Œã¦ã„ã‚‹å ´åˆã¯ã“ã®ã‚¨ãƒ©ãƒ¼ã€‚

### åŸå› 

åºƒå‘Šç³»SDKã®æ›´æ–°æ™‚ã«å¤ã„ãƒ©ã‚¤ãƒ–ãƒ©ãƒªãŒ `[å¯¾è±¡SDK]/Plugins/Android/libs/` é…ä¸‹ã«æ®‹ã£ã¦ãŠã‚Šã€ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã®ç•°ãªã‚‹ãƒ•ã‚¡ã‚¤ãƒ«ãŒé‡è¤‡ã€‚ãƒ©ã‚¤ãƒ–ãƒ©ãƒªå‚ç…§æ™‚ã®ç«¶åˆã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¦ã„ã‚‹ã€‚

ex.)
- `/FacebookSDK/Plugins/Android/libs/facebook-android-wrapper-14.1.0.aar`
- `/FacebookSDK/Plugins/Android/libs/facebook-android-wrapper-17.0.0.aar`

### å¯¾å¿œ

è©²å½“ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã®å¤ã„ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã® `aar` ãƒ•ã‚¡ã‚¤ãƒ«ã‚’å‰Šé™¤ã™ã‚‹ã€‚

### å‚è€ƒ
- https://qiita.com/unsoluble_sugar/items/79a574b43af06cc6e3c6
- https://kingmo.jp/kumonos/android-buildfaile-duplicateclass/